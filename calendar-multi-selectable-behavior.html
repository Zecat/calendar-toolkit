<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="moment-import.html">
<link rel="import" href="calendar-selection-behavior.html">
<link rel="import" href="calendar-selection-behavior.html">
<link rel="import" href="calendar-properties-management-behavior.html">

<script>
  /**
   * @demo demo/index.html
   * @polymerBehavior Polymer.CalendarMultiSelectableBehavior
   */
  Polymer.CalendarMultiSelectableBehaviorImpl = {
  	
  	properties: {
      immediateStartDate: {
        type: Date,
        observer: '_immediateStartDateChange',
        notify: true
      },
      immediateEndDate: {
        type: Date,
        observer: '_immediateEndDateChange',
        notify: true
      }
    },

    observers: [
      '_shouldResetSelecting(selecting)'
    ],

    _shouldResetSelecting: function(selecting) {
      if (!selecting && this.lastEndDate) {
        this.togglePropertyForInterval(this.lastStartDate, this.lastEndDate, 'selecting', false);
      }
    },

    _immediateStartDateChange: function(newImmediateStartDate, previousImmediateStartDate) {
      if (!previousImmediateStartDate || !newImmediateStartDate) {
        return;
      }
      if (newImmediateStartDate < previousImmediateStartDate) {
        previousImmediateStartDate = moment(previousImmediateStartDate).subtract(1, 'day');
      } else {
        newImmediateStartDate = moment(newImmediateStartDate).subtract(1, 'day');
      }
      this.togglePropertyForInterval(newImmediateStartDate, previousImmediateStartDate, 'selected');
      this.togglePropertyForInterval(newImmediateStartDate, previousImmediateStartDate, 'selecting');
    },

    _immediateEndDateChange: function(newImmediateEndDate, previousImmediateEndDate) {
      if (!newImmediateEndDate) {
        return;
      }
      if (!previousImmediateEndDate) {
        this.togglePropertyForDate(newImmediateEndDate, 'selected');
        this.togglePropertyForDate(newImmediateEndDate, 'selecting');
        return;
      }
      if (newImmediateEndDate > previousImmediateEndDate) {
        previousImmediateEndDate = moment(previousImmediateEndDate).add(1, 'day');
      } else {
        newImmediateEndDate = moment(newImmediateEndDate).add(1, 'day');
      }
      this.togglePropertyForInterval(newImmediateEndDate, previousImmediateEndDate, 'selected');
      this.togglePropertyForInterval(newImmediateEndDate, previousImmediateEndDate, 'selecting');
    }

  };

  /** @polymerBehavior */  
  Polymer.CalendarMultiSelectableBehavior = [
    Polymer.CalendarPropertiesManagementBehavior,
    Polymer.CalendarSelectionBehavior,
    Polymer.CalendarMultiSelectableBehaviorImpl
  ];

</script>